var Reader = (function () {

	var min = Math.min;
	var max = Math.max;

	// Sumbols mask
	var symTpls = {
		0: {"0":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":1,"6":1,"7":1},"1":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"2":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"3":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"4":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"5":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"6":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"7":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"8":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"9":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":1,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		1: {"0":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1},"1":{"0":1,"1":0,"2":0,"3":0,"4":1,"5":1},"2":{"0":0,"1":0,"2":0,"3":0,"4":1,"5":1},"3":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1},"4":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1},"5":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1},"6":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1},"7":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1},"8":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1},"9":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1}},
		2: {"0":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"1":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"2":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"3":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"4":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"5":{"0":1,"1":1,"2":1,"3":1,"4":0,"5":0,"6":1,"7":1},"6":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":1,"6":1,"7":1},"7":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":1,"7":1},"8":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":1,"6":1,"7":1},"9":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		3: {"0":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"1":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"2":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"3":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"4":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":0,"6":1,"7":1},"5":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"6":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"7":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"8":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"9":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		4: {"0":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"1":{"0":1,"1":1,"2":1,"3":1,"4":0,"5":0,"6":0,"7":1},"2":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":1},"3":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":0,"6":0,"7":1},"4":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"5":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"6":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"7":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"8":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"9":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		5: {"0":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1},"1":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"2":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"3":{"0":0,"1":0,"2":1,"3":0,"4":0,"5":0,"6":1,"7":1},"4":{"0":0,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"5":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"6":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"7":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"8":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"9":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		6: {"0":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"1":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"2":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":1},"3":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"4":{"0":0,"1":0,"2":1,"3":0,"4":0,"5":0,"6":1,"7":1},"5":{"0":0,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"6":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"7":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"8":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"9":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		7: {"0":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"1":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"2":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"3":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":0,"6":0,"7":1},"4":{"0":1,"1":1,"2":1,"3":1,"4":0,"5":0,"6":1,"7":1},"5":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":1,"6":1,"7":1},"6":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":1,"7":1},"7":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":1,"6":1,"7":1},"8":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"9":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		8: {"0":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"1":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"2":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"3":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"4":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"5":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"6":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"7":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"8":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"9":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		9: {"0":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"1":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"2":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"3":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"4":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":0},"5":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0},"6":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"7":{"0":1,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"8":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"9":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		a: {"0":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"1":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"2":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"3":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1},"4":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":1,"6":0,"7":0},"5":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"6":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"7":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"8":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":0,"6":0,"7":0},"9":{"0":1,"1":0,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		b: {"0":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"1":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"2":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"3":{"0":0,"1":0,"2":1,"3":0,"4":0,"5":0,"6":1,"7":1},"4":{"0":0,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"5":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"6":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"7":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"8":{"0":0,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"9":{"0":0,"1":0,"2":1,"3":0,"4":0,"5":0,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		c: {"0":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"1":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"2":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"3":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1},"4":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":1,"6":0,"7":0},"5":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"6":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"7":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"8":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":1,"6":0,"7":0},"9":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		d: {"0":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"1":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"2":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"3":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0},"4":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":0},"5":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"6":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"7":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"8":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":0},"9":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":1,"6":0,"7":0},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		e: {"0":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"1":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"2":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"3":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"4":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":0,"6":0,"7":1},"5":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":0,"7":0},"6":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},"7":{"0":0,"1":0,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1},"8":{"0":1,"1":0,"2":0,"3":1,"4":1,"5":1,"6":0,"7":0},"9":{"0":1,"1":1,"2":0,"3":0,"4":0,"5":0,"6":0,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}},
		f: {"0":{"0":1,"1":1,"2":1,"3":0,"4":0,"5":0,"6":0,"7":1},"1":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":0,"7":0},"2":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":0,"7":0},"3":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":1,"7":1},"4":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":1,"7":1},"5":{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":1,"7":1},"6":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":1,"7":1},"7":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":1,"7":1},"8":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":1,"7":1},"9":{"0":1,"1":1,"2":0,"3":0,"4":1,"5":1,"6":1,"7":1},"10":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1,"7":1}}
	};

	return nano.implement(
		function (picture) {
			this.picture = picture;
		}, {
			get : function () {
				var thr = this.picture.getThreshold(130, 256);
				var yFrom = null, yTo = null;
				var xFrom = null, xTo = null;
				var x, y;

				// cut empty spaces
				for (y in thr) for (x in thr[y]) {
					if (!thr[y][x]) {
						xFrom = xFrom === null ? x : min(x, xFrom);
						yFrom = yFrom === null ? x : min(y, yFrom);
						xTo   = max(x, xTo);
						yTo   = max(y, yTo);
					}
				}
				var cropped = new Picture(
					this.picture
						.getCropped(xFrom-1, yFrom, xTo-xFrom+3, yTo-yFrom+2)
				);

				thr = cropped.getThreshold(130, 256);

				// split symbols and push its mask to array
				var symbols = [];
				var start   = null;
				for (x in thr[0]) {
					if (this.isColumnEmpty(thr, x)) {
						if (start !== null) {
							var symbolImg = cropped.getCropped(start, 0, x - start, cropped.canvas.height);
							symbols.push(new Picture(symbolImg).getThreshold(130, 256));
						}
						start = null;
					} else {
						if (start === null) start = x * 1;
					}
				}

				// try to find right symbols
				var result = '';
				symbols.forEach(function (sym, i) {
					for (var k in symTpls) {
						if (nano.deepEquals(symTpls[k], sym)) {
							result += k;
							return;
						}
					}
					throw 'Fail';
				});

				return result;
			},
			isColumnEmpty : function (thr, x) {
				for (var y in thr) {
					if (!thr[y][x]) return false;
				}
				return true;
			}
		}
	);

})();